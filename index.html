<script src="http://{ipAndPort}/socket.io/socket.io.js"></script>
<style>
    .blackboard {
        height: 500px;
        width: 500px;
        float: left;
        background-color: lightblue;
    }

    .result {
        height: 400px;
        width: 500px;
        float: right;
        background-color: lightgreen;
        overflow: scroll;
    }

    .configurations {
        display: table;
        padding: 5px;
    }
</style>
<script>
    window.addEventListener('DOMContentLoaded', function () {

        var socket = io("http://{ipAndPort}");

        var sendData = null;
        var lastValue = '';
        socket.on('news', function (data) {
            console.log(data);
        });

        socket.on("hints", function (data) {
            data = data || {};
            // if (!data.isEqual) {
            renderData(data);
            // }
        });

        socket.on("categories", function (categories) {
            categories = categories || [];

            for (var index = 0; index < categories.length; index++) {
                var element = categories[index];
                var li = document.createElement("li");
                li.appendChild(document.createTextNode("[" + element.INTERNALCODE + "] " + element.VALUE));
                categoryElement.appendChild(li);
            }
        });

        var resultElement = document.getElementById("hintresults"),
            blackboradElement = document.getElementById("editor"),
            modeSeachElement = document.getElementById('modesearch'),
            categoryElement = document.getElementById("categorylist"),
            recordIdElement = document.getElementById("recordid"),
            findTypeElement = document.getElementById("hinttype");
        /**
        * renderData dibujar los resultados
        * @private
        */
        renderData = function (data) {
            rawdata = data.records || [];
            //<debug>

            var times = new Date().getTime() - sendData;
            console.log('records:', rawdata.length, 'time (ms):', times);
            //</debug>
            var results = '';

            // resultElement.innerHTML = '';

            var rawdata = rawdata || [];
            var length = rawdata.length > 100 ? 100 : rawdata.length;
            for (var index = 0; index < length; index++) {
                var element = rawdata[index];
                //var final = highlighter(element.v, lastValue);
                var final = wrapInTag(element.VALUE, lastValue);
                //wrapInTag
                results += '<li>[' + element.INTERNALCODE + '] ' + final + '</li>';
            }
            resultElement.innerHTML = results;
        },
            /**
             * searchValue buscar coinsidencias en el servidor
             * @private
             */
            searchValue = function (value) {
                //<debug>
                sendData = new Date().getTime()
                //</debug>
                lastValue = value;
                socket.emit(
                    findTypeElement.value,
                    {
                        value: value,
                        eventValue: recordIdElement.value,
                        lang: "ES"
                    });
            },
            /**
             * @method searchOnWebService call rest web service
             * @return {Array} rawdata `[]` data response to web service
             * @private
             */
            searchOnWebService = function () {
                var rawdata = [];

                return rawdata;
            };

        wrapInTag = function (item, text) {
            var tag = 'strong',
                words = text.split(" ") || [],
                regex = RegExp(words.join('|'), 'gi'),
                replacement = '<' + tag + '>$&</' + tag + '>';

            return item.replace(regex, replacement);
        };

        highlighter = function (item, query) {
            query = query || this.query;
            query = query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, '\\$&');

            return item.replace(new RegExp('(' + query + ')', 'ig'), function ($1, match) {
                return '<strong>' + match + '</strong>'
            })
        }
        blackboradElement.onkeyup = function () {
            var value = this.value || '';
            if (value) {
                //<debug>
                console.log('search', value);
                //</debug>
                searchValue(value);
            } else {
                resultElement.innerHTML = '';
            }
        };
    }, true);

</script>
<!--<div class="blackboard" contenteditable="true"></div>-->
<h1> Monitor Intellisense - Module </h1>
<textarea id="editor" rows="12" cols="80"></textarea>
<div class="result">
    <ol id="hintresults"> </ol>
</div>
<div class="total"></div>
<div class="configurations">
    <label for="hinttype">Buscar</label>
    <select id="hinttype">
  <option value="field">Field</option>
  <option value="operator">Opradores</option>
  <option value="connector">Conectores</option>
</select> <br>

    <label for="modesearch">Modo de busqueda</label>
    <select id="modesearch">
  <option value="ontyping">en linea</option>
  <option value="onpause">en pausa</option>
</select> <br>

    <label for="recordid">Record ID</label>
    <input type="text" id="recordid" value="0E45E63F-AA19-44E1-9DBF-DC3EB702D113">

    <br><label> Categorias </label> <br>
    <div class="result">
        <ul id="categorylist"></ul>
    </div>
</div>