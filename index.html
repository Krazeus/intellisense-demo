<script src="http://{ipAndPort}/socket.io/socket.io.js"></script>
<style>
    .blackboard {
        height: 500px;
        width: 500px;
        float: left;
        background-color: lightblue;
    }



    .result {
        height: 500px;
        width: 500px;
        float: right;
        background-color: lightgreen;
        overflow: scroll;
    }
</style>
<script>
    window.addEventListener('DOMContentLoaded', function () {

        var socket = io("http://{ipAndPort}");

        var sendData = null;
        var lastValue = '';
        socket.on('news', function (data) {
            console.log(data);
        });

        socket.on("hints", function (data) {
            data = data || {};
            if (!data.isEqual) {
                renderData(data);
            }
        });

        var resultElement = document.getElementsByClassName("results")[0],
            blackboradElement = document.getElementById("editor"),
            indexElement = document.getElementById('index'),
            findTypeElement = document.getElementById("hinttype");
        /**
        * renderData dibujar los resultados
        * @private
        */
        renderData = function (data) {
            rawdata = data.records || [];
            //<debug>

            var times = new Date().getTime() - sendData;
            console.log('records:', rawdata.length, 'time (ms):', times);
            //</debug>
            var results = '';

            // resultElement.innerHTML = '';

            var rawdata = rawdata || [];
            var length = rawdata.length > 100 ? 100 : rawdata.length;
            for (var index = 0; index < length; index++) {
                var element = rawdata[index];
                //var final = highlighter(element.v, lastValue);
                var final = wrapInTag(element.VALUE, lastValue);
                //wrapInTag
                results += '<li>' + final + '</li>';
            }
            resultElement.innerHTML = results;
        },
            /**
             * searchValue buscar coinsidencias en el servidor
             * @private
             */
            searchValue = function (value) {
                //<debug>
                sendData = new Date().getTime()
                //</debug>
                lastValue = value;
                socket.emit(
                    findTypeElement.value,
                    {
                        value: value,
                        index: indexElement.value,
                        eventValue: "865066397",
                        lang: "ES"
                    });
            },
            /**
             * @method searchOnWebService call rest web service
             * @return {Array} rawdata `[]` data response to web service
             * @private
             */
            searchOnWebService = function () {
                var rawdata = [];

                return rawdata;
            };

        wrapInTag = function (item, text) {
            //text = text.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, '\\$&');//Se reemplaza en la normalizacion
            var tag = 'strong',
                words = text.split(" ") || [],
                regex = RegExp(words.join('|'), 'gi'),
                replacement = '<' + tag + '>$&</' + tag + '>';

            return item.replace(regex, replacement);
        };

        highlighter = function (item, query) {
            query = query || this.query;
            query = query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, '\\$&');

            return item.replace(new RegExp('(' + query + ')', 'ig'), function ($1, match) {
                return '<strong>' + match + '</strong>'
            })
        }
        blackboradElement.onkeyup = function () {
            var value = this.value;
            if (value) {
                //<debug>
                console.log('search', value);
                //</debug>
                searchValue(value);
            }
        };
    }, true);

</script>
<!--<div class="blackboard" contenteditable="true"></div>-->
<textarea id="editor" rows="12" cols="80"></textarea>
<div class="result">
    <ol class="results"> </ol>
</div>
<div class="total"></div>
<label for="index">No. Index:</label>
<select id="index">
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
</select>

<label for="index">type:</label>
<select id="hinttype">
  <option value="search">Field</option>
  <option value="operator">Opradores</option>
  <option value="conector">Conectores</option>
</select>

<button onclick="searchOnWebService"> call rest </button>